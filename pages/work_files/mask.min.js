(function(e){"function"===typeof define&&define.amd?define(["jquery"],e):e(window.jQuery||window.Zepto)})(function(e){var A=function(a,f,b){var g=this,k,n;a=e(a);f="function"===typeof f?f(a.val(),void 0,a,b):f;var d={getCaret:function(){try{var c=0,p=a.get(0),d=document.selection,h=p.selectionStart;if(d&&!~navigator.appVersion.indexOf("MSIE 10")){var f=d.createRange();f.moveStart("character",a.is("input")?-a.val().length:-a.text().length);c=f.text.length}else if(h||"0"===h)c=h;return c}catch(m){}},
setCaret:function(c){try{if(a.is(":focus")){var p=a.get(0);if(p.setSelectionRange)p.setSelectionRange(c,c);else if(p.createTextRange){var d=p.createTextRange();d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",c);d.select()}}}catch(h){}},events:function(){a.on("keydown.mask",function(){k=d.val()}).on("keyup.mask",d.behaviour).on("paste.mask drop.mask",function(){setTimeout(function(){a.keydown().keyup()},100)}).on("change.mask",function(){a.data("changed",!0)}).on("blur.mask",function(){k===
a.val()||a.data("changed")||a.trigger("change");a.data("changed",!1)}).on("focusout.mask",function(){b.clearIfNotMatch&&!n.test(d.val())&&d.val("")})},getRegexMask:function(){for(var c=[],a,d,h,b,e=0;e<f.length;e++)(a=g.translation[f[e]])?(d=a.pattern.toString().replace(/.{1}$|^.{1}/g,""),h=a.optional,(a=a.recursive)?(c.push(f[e]),b={digit:f[e],pattern:d}):c.push(h||a?d+"?":d)):c.push(f[e].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$\x26"));c=c.join("");b&&(c=c.replace(new RegExp("("+b.digit+"(.*"+b.digit+
")?)"),"($1)?").replace(new RegExp(b.digit,"g"),b.pattern));return new RegExp(c)},destroyEvents:function(){a.off("keydown keyup paste drop change blur focusout DOMNodeInserted ".split(" ").join(".mask ")).removeData("changeCalled")},val:function(c){var d=a.is("input");return 0<arguments.length?d?a.val(c):a.text(c):d?a.val():a.text()},getMCharsBeforeCount:function(c,a){for(var d=0,b=0,p=f.length;b<p&&b<c;b++)g.translation[f.charAt(b)]||(c=a?c+1:c,d++);return d},caretPos:function(c,a,b,h){return g.translation[f.charAt(Math.min(c-
1,f.length-1))]?Math.min(c+b-a-h,b):d.caretPos(c+1,a,b,h)},behaviour:function(a){a=a||window.event;var c=a.keyCode||a.which;if(-1===e.inArray(c,g.byPassKeys)){var b=d.getCaret(),f=d.val(),v=f.length,m=b<v,k=d.getMasked(),l=k.length,n=d.getMCharsBeforeCount(l-1)-d.getMCharsBeforeCount(v-1);k!==f&&d.val(k);!m||65===c&&a.ctrlKey||(8!==c&&46!==c&&(b=d.caretPos(b,v,l,n)),d.setCaret(b));return d.callbacks(a)}},getMasked:function(a){var c=[],e=d.val(),h=0,k=f.length,m=0,n=e.length,l=1,w="push",r=-1;if(b.reverse){w=
"unshift";l=-1;var t=0;h=k-1;m=n-1;var q=function(){return-1<h&&-1<m}}else t=k-1,q=function(){return h<k&&m<n};for(;q();){var x=f.charAt(h),y=e.charAt(m),u=g.translation[x];if(u)y.match(u.pattern)?(c[w](y),u.recursive&&(-1===r?r=h:h===t&&(h=r-l),t===r&&(h-=l)),h+=l):u.optional&&(h+=l,m-=l),m+=l;else{if(!a)c[w](x);y===x&&(m+=l);h+=l}}a=f.charAt(t);k!==n+1||g.translation[a]||c.push(a);return c.join("")},callbacks:function(c){var e=d.val(),g=e!==k;if(!0===g&&"function"===typeof b.onChange)b.onChange(e,
c,a,b);if(!0===g&&"function"===typeof b.onKeyPress)b.onKeyPress(e,c,a,b);if("function"===typeof b.onComplete&&e.length===f.length)b.onComplete(e,c,a,b)}};g.mask=f;g.options=b;g.remove=function(){d.destroyEvents();d.val(g.getCleanVal()).removeAttr("maxlength");var c=d.getCaret();d.setCaret(c-d.getMCharsBeforeCount(c));return a};g.getCleanVal=function(){return d.getMasked(!0)};g.init=function(){b=b||{};g.byPassKeys=[9,16,17,18,36,37,38,39,40,91];g.translation={0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},
"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}};g.translation=e.extend({},g.translation,b.translation);g=e.extend(!0,{},g,b);n=d.getRegexMask();!1!==b.maxlength&&a.attr("maxlength",f.length);b.placeholder&&a.attr("placeholder",b.placeholder);a.attr("autocomplete","off");d.destroyEvents();d.events();var c=d.getCaret();d.val(d.getMasked());d.setCaret(c+d.getMCharsBeforeCount(c,!0))}()},q={},z=function(){var a=e(this),f={};a.attr("data-mask-reverse")&&(f.reverse=!0);
"false"===a.attr("data-mask-maxlength")&&(f.maxlength=!1);a.attr("data-mask-clearifnotmatch")&&(f.clearIfNotMatch=!0);a.mask(a.attr("data-mask"),f)};e.fn.mask=function(a,f){var b=this.selector,g=function(){var b=e(this).data("mask"),g=JSON.stringify;if("object"!==typeof b||g(b.options)!==g(f)||b.mask!==a)return e(this).data("mask",new A(this,a,f))};this.each(g);b&&!q[b]&&(q[b]=!0,setTimeout(function(){e(document).on("DOMNodeInserted.mask",b,g)},500))};e.fn.unmask=function(){try{return this.each(function(){e(this).data("mask").remove().removeData("mask")})}catch(a){}};
e.fn.cleanVal=function(){return this.data("mask").getCleanVal()};e("*[data-mask]").each(z);e(document).on("DOMNodeInserted.mask","*[data-mask]",z)});